---
slug: threads-and-thoughts
title: "Threads and Thoughts: Building a Living, Breathing City"
authors: [leaddev]
date: 2025-08-18
description: How multithreaded AI, perception, and crafting systems turned Cobblestone Legacy’s city into a living ecosystem.
tags: [devlog, ai, worldbuilding]
---

With the heavy engineering lift behind us, summer 2025 was the season of *content*. The mission: transform Cobblestone City from a static sandbox into a living simulation brimming with personality. Multithreaded AI, systemic quests, and action-driven crafting all clicked into place—thanks to the groundwork laid in earlier posts.

<!-- truncate -->

## Smarter Citizens Through Perception and Routine

Every NPC in the city now springs from a shared architecture:

- **Actor base class:** common hooks for movement, inventory, vitals, and dialogue.
- **ActorController:** a native state machine that orchestrates goals, pathfinding, and reactions.
- **AI Agency:** NPCs dont only have schedules that send bakers to ovens at dawn, guards on patrol at dusk, and urchins exploring markets after school, they have needs, responsibilities and goals. How those goals are met is handled by the Dynamic Quest system that are generated by the NPCs themselves, and the StateMachine responsible for turning each objective into actions.

To make the city feel reactive, I built a `SpatialGrid` perception system. NPCs query nearby cells each tick, checking sight lines and listening for propagated sound events. When one character shouts or breaks a bottle, everyone within earshot perks up. Watching guards respond to a lockpick attempt—while another character tries to stay invisible—was a delightful reminder that simulation beats scripted set pieces every time.

:::info Personality Sparks
We even experimented with lightweight personality traits, but the system quickly grew into something much deeper. Every NPC carries a unique personality profile that shapes how they see the world, interpret events, and judge others. Their biases and tendencies drive moment-to-moment decisions: brave NPCs investigate danger while cautious ones flee, a beggar might shadow a player carrying food, and a scheming gang member could hold back until allies arrive. These traits also influence long-term emotions and relationships, ensuring no two characters think or feel quite the same.
:::


## Emergent Stories Everywhere

Systemic design invited surprises daily:

- Friendly NPCs greet each other when their patrol paths cross, gossip spreading hints about hidden stashes.
- Rival factions collide when their zones overlap, sometimes erupting into spontaneous street brawls.
- Quests emerge from needs: shopkeepers ask for supply runs when stock runs low, guards recruit allies when the alert level rises.

Behind the curtain, quests are generated and synced across clients via our SQLite-backed `QuestLog`. Multiplayer support means if players take the same quest, they receive the same objectives, debate strategies, and celebrate (or commiserate) together.

## Crafting, Survival, and the Player’s Toolkit

While NPCs gained depth, we gave players richer tools:

- **Action-based crafting:** tools act on materials logically. Use a blunt object on a glass bottle to shatter it into shards; apply a chisel to wood to carve components.
- **Skillful iteration:** the more you craft, the better the outcomes—higher durability gear, unique variants, even opportunities to influence the city’s economy.
- **Expanded survival:** hunger, thirst, exhaustion, and illness affect both players and NPCs. Screen cues and animations telegraph needs so strategy becomes second nature.

The kids will love stress-testing the crafting sandbox, filling alleyways with the debris of their experiments. Their discoveries often inspire new recipes or tweaks to tool behavior.


## Developer’s Reflection

> *Systems create stories when you trust them.*
>
> This phase taught me restraint and patience. By polishing a few key mechanics—perception, routines, crafting—we unlocked layers of emergent narrative without scripting every beat. The city finally feels alive, and the next challenge is to polish the user experience so more people can enjoy it.

Fall’s roadmap focuses on usability, content polish, and preparing for a potential wider playtest. But before that, one more devlog remains to wrap up the journey so far.
